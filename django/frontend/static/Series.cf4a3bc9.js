import{r as o}from"./rankingService.45c233ea.js";import{_ as x,g as c,h as p,q as m,x as f,z as g,A as y,j as S,aD as $,az as k}from"./index.29aea1ba.js";import{a as I}from"./VSelect.92332a5d.js";import{_}from"./VDataTable.97d89a32.js";import{p as C}from"./purify.es.c2745514.js";import"./VChip.d768fea7.js";var j=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e(x,[e(c,{staticClass:"mb-5"},[e(p,[e("small",[t._v("Archers Summary")]),e(m),e(I,{attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:t.s_search,callback:function(a){t.s_search=a},expression:"s_search"}})],1),e(_,{attrs:{"mobile-breakpoint":300,dense:"",headers:t.s_table_header,items:t.s_table,search:t.s_search,loading:t.loading,"group-by":"class","multi-sort":"","items-per-page":50}})],1),t.s.club_ranking?e(c,[e(p,[e("small",[t._v("Clubs Summary")]),e(m)],1),e(_,{attrs:{"mobile-breakpoint":300,dense:"",headers:t.c_table_header,items:t.c_table,loading:t.loading,"multi-sort":"","items-per-page":15}})],1):t._e()],1)},A=[];const P={components:{},data:()=>({s_search:""}),computed:{...f({user:t=>t.user.user}),s(){return this.$store.getters["series/seriesById"](parseInt(this.$route.params.id))},loading(){if(this.s_table.length)return!1;if(this.s){for(let t of this.s.stages)if(Array.isArray(t.participants))return!1}return!0},s_table_header(){if(this.s){let t=[{text:"Class",value:"class"},{text:"Place",value:"place",width:"1%"},{text:"Name",value:"name",width:"175px"},{text:"Club",value:"club"},{text:"Points",value:"points"},{text:"Sum",value:"sum"}];return t.push(...this.s.stages.map(function(s){return{text:s.name,value:"stage"+s.id.toString(),class:"stage-header"}}).reverse()),t}return[]},c_table_header(){if(this.s_table&&this.s.club_ranking){let t=[{text:"Place",value:"place",width:"1%"},{text:"Club",value:"club"},{text:"Points",value:"points"}];return t.push(...this.s.stages.map(function(s){return{text:s.name,value:"stage"+s.id.toString(),class:"stage-header"}}).reverse()),t}return[]},s_table(){if(this.s){let t=[];for(let s of this.s.stages){if(!Array.isArray(s.participants))continue;let e=s.rounds.find(i=>i.course_details.type==="s");e=e?e.id:null;let a=s.participants.map(i=>({name:i.full_name,class:o.getClass(i,this.s.ignore_gender),id:i.archer.id+i.age_group+i.style,club:i.archer_rep.split("|")[0],sum:o.sum(i.scorecards.filter(n=>n.round!==e).map(n=>n.score)),x:o.sum(i.scorecards.filter(n=>n.round!==e).map(n=>n.spots)),shootoff:e?o.sum(i.scorecards.filter(n=>n.round===e).map(n=>n.score)):null,progress:!0}));o.participantRank(a);let r=a.reduce((i,n)=>i.set(n.class,(i.get(n.class)||0)+1),new Map),l={class:null,points:null};for(let i of a.filter(n=>n.sum>0)){i.class!==l.class&&(l.class=i.class,l.points=Math.min(this.s.points_max,r.get(i.class))),i.points=l.points>=i.place&&i.sum>0?l.points-i.place+1:0;let n=t.findIndex(u=>u.id===i.id);n===-1?(t.push({id:i.id,class:i.class,name:i.name,club:i.club,sum:[i.sum],points:[i.points]}),t[t.length-1]["stage"+s.id.toString()]=(i.points>0?i.points:"-")+" ("+i.sum+")"):(t[n].sum.push(i.sum),t[n].points.push(i.points),t[n]["stage"+s.id.toString()]=(i.points>0?i.points:"-")+" ("+i.sum+")")}}for(let s of t)s.sum.sort(function(e,a){return s.points[s.sum.indexOf(a)]-s.points[s.sum.indexOf(e)]}),s.points.sort(function(e,a){return a-e}),s.points.length>=this.s.participant_min&&(s.place=null),s.points.length>=this.s.participant_max?(s.points=o.sum(s.points.slice(0,this.s.participant_max)),s.sum=o.sum(s.sum.slice(0,this.s.participant_max))):(s.points=o.sum(s.points),s.sum=o.sum(s.sum));return t.sort(function(s,e){return s.class<e.class?-1:s.class>e.class||s.points<e.points?1:s.points>e.points?-1:s.sum<e.sum?1:s.sum>e.sum?-1:0}).map(s=>(s.class!==this.class&&(this.class=s.class,this.ord=1,this.place=1,this.points=s.points,this.sum=s.sum),s.place===null&&s.points>0&&((s.points<this.points||s.sum<this.sum)&&(this.place=this.ord),s.place=this.place,this.ord+=1,this.sum=s.sum,this.points=s.points),s.points===0&&(s.points="-"),s),{class:null,place:1,ord:1,sum:null,points:null}).sort(function(s,e){return s.class<e.class?-1:s.class>e.class||(s.place||9999)>(e.place||9999)?1:(s.place||9999)<(e.place||9999)?-1:0})}return[]},c_table(){if(this.s_table.length&&this.s.club_ranking){let t=[];for(let s of this.s.stages){let e="stage"+s.id.toString(),a={};for(let r of this.s_table)if(r[e]){r.class in a||(a[r.class]={}),r.club in a[r.class]||(a[r.class][r.club]=[]);let l=parseInt(r[e].split(" ")[0])||0;a[r.class][r.club].push(l)}for(let r of Object.values(a))for(let l in r){let i=0;r[l].length>this.s.club_ranking_max?i=o.sum(r[l].sort(function(u,b){return b-u}).splice(0,this.s.club_ranking_max)):i=o.sum(r[l]);let n=t.findIndex(u=>u.club===l);n===-1?(t.push({club:l,place:null,points:i}),t[t.length-1][e]=i):(e in t[n]?t[n][e]+=i:t[n][e]=i,t[n].points+=i)}}return t.sort(function(s,e){return s.points>e.points?-1:s.points<e.points?1:0}).map(s=>(s.points<this.points&&(this.place=this.ord),s.place=this.place,this.points=s.points,this.ord+=1,s),{place:1,ord:1,points:null})}return[]}},methods:{}},h={};var z=g(P,j,A,!1,M,null,null,null);function M(t){for(let s in h)this[s]=h[s]}var v=function(){return z.exports}(),w=function(){var t=this,s=t.$createElement,e=t._self._c||s;return t.s?e(y,[e(c,[e(p,[t._v(t._s(t.s.name))]),e(S,[e("p",{domProps:{innerHTML:t._s(t.series_desciption)}}),t.s_table.body.length?[e("h3",[t._v("Stages:")]),e(_,{attrs:{dense:"","mobile-breakpoint":300,headers:t.s_table.header,items:t.s_table.body,"hide-default-header":"","hide-default-footer":""},scopedSlots:t._u([{key:"item.event",fn:function(a){var r=a.item;return[e("router-link",{attrs:{to:{name:"event",params:{id:r.eId}}}},[t._v(t._s(r.event))])]}}],null,!1,2767513430)})]:t._e()],2),e(v)],1)],1):e($,[e(k,{attrs:{indeterminate:"",size:"64"}})],1)},D=[];const E={components:{seriesSummary:v},data:()=>({}),computed:{...f({user:t=>t.user.user}),series_desciption(){return C.sanitize(this.s.description.split(`

`).join("</p><p>").split(`
`).join("<br/>"))},s(){return this.$store.getters["series/seriesById"](parseInt(this.$route.params.id))},s_table(){return this.s&&this.s.stages?{header:[{text:"Event",value:"event"},{text:"Date",value:"date"},{text:"Participants",value:"participants"}],body:this.s.stages.reverse().map(t=>{let s=t.participants.length;return{event:t.name,eId:t.id,date:t.date_start,participants:s&&s>1?s+" participants":""}})}:{header:[],body:[]}}},created(){this.$store.dispatch("series/updateSeries",parseInt(this.$route.params.id)).catch(()=>{this.$router.push("/series")})}},d={};var O=g(E,w,D,!1,R,null,null,null);function R(t){for(let s in d)this[s]=d[s]}var L=function(){return O.exports}();export{L as default};
